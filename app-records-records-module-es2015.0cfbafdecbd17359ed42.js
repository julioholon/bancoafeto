(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"1V/X":function(e,t,i){"use strict";i.r(t),i.d(t,"RecordsModule",(function(){return rt}));var n=i("iInd"),s=i("ofEL"),a=i("XDzf"),r=i("Do6i"),o=i("WI1B"),l=i("x6mR"),c=i("ObUu"),d=i("LvDl"),u=i("8Y7J"),b=i("8UBS"),f=i("SVse"),h=i("HQV3"),p=i("s7LF"),m=i("UXR7"),g=i("bqp0"),v=i("AH7H"),y=i("Y+zs");function F(e,t){if(1&e&&(u.Rb(0),u.Ob(1,"user-info",9),u.Ob(2,"hr"),u.Qb()),2&e){const e=u.dc(2);u.zb(1),u.kc("user",e.data.user)}}function S(e,t){1&e&&u.Ob(0,"hr",12)}function k(e,t){if(1&e&&(u.Rb(0),u.Ob(1,"rich-text-container",10),u.Fc(2,S,1,0,"hr",11),u.Qb()),2&e){const e=u.dc(2);u.zb(1),u.kc("value",e.data.type.informationText),u.zb(1),u.kc("ngIf",e.data.fields)}}const T=function(e,t,i){return{"mb-0":e,"mb-2":t,"border-top-0":i}};function I(e,t){if(1&e&&(u.Tb(0,"h2",13),u.Hc(1),u.Sb()),2&e){const e=u.dc(2);u.kc("ngClass",u.pc(2,T,"above"===e.labelPosition,"above"!==e.labelPosition,!e.data.type.informationText)),u.zb(1),u.Jc(" ",e.i18n.record.fields," ")}}function z(e,t){if(1&e&&u.Ob(0,"custom-field-input",14),2&e){const e=t.$implicit,i=u.dc(2);u.Bb(i.resolveColumnClass(e)),u.kc("labelPosition",i.labelPosition)("field",e)("formControl",i.form.get("customValues").get(e.internalName))("binaryValues",i.binaryValues)}}function w(e,t){if(1&e&&u.Ob(0,"custom-field-input",14),2&e){const e=t.$implicit,i=u.dc(3);u.Bb(i.resolveColumnClass(e)),u.kc("labelPosition",i.labelPosition)("field",e)("formControl",i.form.get("customValues").get(e.internalName))("binaryValues",i.binaryValues)}}const O=function(e,t,i,n){return{"mb-0":e,"mb-2":t,"mt-4":i,"border-top-0":n}};function C(e,t){if(1&e&&(u.Rb(0),u.Tb(1,"h2",13),u.Hc(2),u.Sb(),u.Fc(3,w,1,6,"custom-field-input",6),u.Qb()),2&e){const e=t.$implicit,i=t.first,n=u.dc(2);u.zb(1),u.kc("ngClass",u.qc(3,O,"above"===n.labelPosition,"above"!==n.labelPosition,n.fieldsWithoutSection.length>0,i&&0==n.fieldsWithoutSection.length)),u.zb(1),u.Jc(" ",e.name," "),u.zb(1),u.kc("ngForOf",n.fieldsWithSection.get(e))}}const P=function(e){return{"mr-n3":e}};function R(e,t){if(1&e){const e=u.Ub();u.Tb(0,"page-content",2),u.Fc(1,F,3,1,"ng-container",3),u.Tb(2,"form",4),u.Fc(3,k,3,2,"ng-container",3),u.Fc(4,I,2,6,"h2",5),u.Fc(5,z,1,6,"custom-field-input",6),u.Fc(6,C,4,8,"ng-container",7),u.Sb(),u.Tb(7,"actions"),u.Tb(8,"button",8),u.bc("click",(function(){return u.wc(e),u.dc().save()})),u.ec(9,"async"),u.Hc(10),u.Sb(),u.Sb(),u.Sb()}if(2&e){const e=u.dc();u.kc("heading",e.create?e.i18n.record.title.new(e.data.type.name):e.i18n.record.title.edit(e.data.type.name))("mobileHeading",e.create?e.i18n.record.mobileTitle.new(e.data.type.name):e.i18n.record.mobileTitle.edit(e.data.type.name)),u.zb(1),u.kc("ngIf",e.data.user&&!e.authHelper.isSelf(e.data.user)),u.zb(1),u.kc("formGroup",e.form)("ngClass",u.nc(13,P,e.columnLayout)),u.zb(1),u.kc("ngIf",e.data.type.informationText),u.zb(1),u.kc("ngIf",e.fieldsWithoutSection.length>0),u.zb(1),u.kc("ngForOf",e.fieldsWithoutSection),u.zb(1),u.kc("ngForOf",e.fieldsWithSection.keys()),u.zb(2),u.kc("disabled",u.fc(9,11,e.requesting$)),u.zb(2),u.Jc(" ",e.i18n.general.save," ")}}let $=(()=>{class e extends l.a{constructor(e,t,i){super(e),this.recordsService=t,this.recordsHelper=i,this.fieldsWithSection=new Map}ngOnInit(){super.ngOnInit(),this.param=this.route.snapshot.params.owner,this.type=this.route.snapshot.params.type,this.create=null!=this.param,this.id=this.route.snapshot.paramMap.get("id");const e=this.create?this.recordsService.getRecordDataForNew({owner:this.param,type:this.type}):this.recordsService.getRecordDataForEdit({id:this.id});this.addSub(e.subscribe(e=>{this.data=e}))}onDataInitialized(e){this.columnLayout=this.recordsHelper.isColumnLayout(e.type),this.fieldsWithoutSection=e.fields.filter(e=>null==e.section)||[],(e.type.sections||[]).forEach(t=>{const i=e.fields.filter(e=>null!=e.section&&e.section.id===t.id);Object(c.h)(i)||this.fieldsWithSection.set(t,i)}),this.form=this.formBuilder.group({}),this.form.setControl("customValues",this.fieldHelper.customValuesFormGroup(e.fields,{currentValues:e.record.customValues,disabledProvider:t=>!this.create&&-1===(e.editableFields||[]).indexOf(t.internalName)}))}resolveColumnClass(e){return this.recordsHelper.resolveColumnClass(e,this.data.type)}get binaryValues(){return this.data.binaryValues}get labelPosition(){return this.columnLayout?"above":"auto"}resolveMenu(e){return this.recordsHelper.menuForRecordType(e.user,e.type)}save(){if(Object(c.F)(this.form),!this.form.valid)return;const e=Object(d.cloneDeep)(this.data.record);e.customValues=this.form.value.customValues;const t=this.create?this.recordsService.createRecord({owner:this.param,type:this.type,body:e}):this.recordsService.updateRecord({id:this.id,body:e});this.addSub(t.subscribe(e=>{this.notification.snackBar(this.create?this.i18n.record.created(this.data.type.name):this.i18n.record.saved(this.data.type.name));const t=null==this.id;if(t&&this.data.type.layout===a.ab.SINGLE)for(const i of this.recordsHelper.recordPermissions(null==this.data.user))i.type.id===this.data.type.id&&(i.singleRecordId=e);this.router.navigate(["/records","view",e||this.id],{replaceUrl:t})}))}}return e.\u0275fac=function(t){return new(t||e)(u.Nb(u.r),u.Nb(r.C),u.Nb(o.a))},e.\u0275cmp=u.Hb({type:e,selectors:[["record-form"]],features:[u.wb],decls:3,vars:4,consts:[[3,"ready"],[3,"heading","mobileHeading",4,"ngIf"],[3,"heading","mobileHeading"],[4,"ngIf"],[3,"formGroup","ngClass"],[3,"ngClass",4,"ngIf"],[3,"labelPosition","field","formControl","class","binaryValues",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"disabled","click"],[3,"user"],[3,"value"],["class","border-0",4,"ngIf"],[1,"border-0"],[3,"ngClass"],[3,"labelPosition","field","formControl","binaryValues"]],template:function(e,t){1&e&&(u.Tb(0,"page-layout",0),u.ec(1,"async"),u.Fc(2,R,11,15,"page-content",1),u.Sb()),2&e&&(u.kc("ready",u.fc(1,2,t.data$)),u.zb(2),u.kc("ngIf",t.data))},directives:[b.a,f.t,h.a,p.I,p.w,p.n,f.q,f.s,m.a,g.a,v.a,y.a,p.v,p.k],pipes:[f.b],encapsulation:2,changeDetection:0}),e})();var H=i("tAww"),N=i("rCAV"),V=i("tVPo"),x=i("DIHi"),D=i("JbOn"),L=i("6g1M"),A=i("2KYv"),M=i("n1JJ"),B=i("DAJ4"),E=i("JFlR"),J=i("7HWn"),U=i("4APx"),W=i("chz4"),j=i("uao2"),G=i("fe3a"),q=i("wwxf"),Q=i("5Wk5"),_=i("978R"),K=i("H4pW"),Y=i("/kmK");function X(e,t){1&e&&u.Ob(0,"div",5)}function Z(e,t){if(1&e&&(u.Rb(0),u.Tb(1,"div",5),u.Tb(2,"label-value",15),u.Ob(3,"user-link",16),u.Sb(),u.Sb(),u.Fc(4,X,1,0,"div",17),u.Qb()),2&e){const e=u.dc(2);u.zb(2),u.kc("label",e.i18n.general.user),u.zb(1),u.kc("user",e.user),u.zb(1),u.kc("ngIf",e.layout.gtsm$)}}function ee(e,t){if(1&e&&u.Ob(0,"field-option",22),2&e){const e=t.$implicit,i=u.dc(4);u.kc("value",i.ApiHelper.internalNameOrId(e))("internalName",e.internalName)("id",e.id)("text",e.name)("parent",e.groupSet)}}function te(e,t){if(1&e&&(u.Tb(0,"div",5),u.Tb(1,"multi-selection-field",20),u.Fc(2,ee,1,5,"field-option",21),u.Sb(),u.Sb()),2&e){const e=u.dc(3);u.zb(1),u.kc("label",e.i18n.user.groups),u.zb(1),u.kc("ngForOf",e.groups)}}const ie=function(){return["broker"]},ne=function(e){return{roles:e}};function se(e,t){if(1&e&&(u.Rb(0),u.Fc(1,te,3,2,"div",17),u.Tb(2,"div",5),u.Ob(3,"user-field",18),u.Sb(),u.Tb(4,"div",5),u.Ob(5,"user-field",19),u.Sb(),u.Qb()),2&e){const e=u.dc(2);u.zb(1),u.kc("ngIf",e.groups.length>1),u.zb(2),u.kc("label",e.i18n.user.broker)("filters",u.nc(5,ne,u.mc(4,ie))),u.zb(2),u.kc("label",e.i18n.general.user)}}function ae(e,t){if(1&e&&(u.Tb(0,"div",5),u.Ob(1,"custom-field-filter",23),u.Sb()),2&e){const e=t.$implicit,i=u.dc(2);u.zb(1),u.kc("field",e)("formControl",i.form.get("customValues").get(e.internalName))}}function re(e,t){if(1&e&&(u.Tb(0,"div",5),u.Ob(1,"basic-profile-field-filter",23),u.Sb()),2&e){const e=t.$implicit,i=u.dc(3);u.zb(1),u.kc("field",e)("formControl",i.form.get("profileFields").get(e.field))}}function oe(e,t){if(1&e&&(u.Tb(0,"div",5),u.Ob(1,"custom-field-filter",23),u.Sb()),2&e){const e=t.$implicit,i=u.dc(3);u.zb(1),u.kc("field",e)("formControl",i.form.get("profileFields").get(e.internalName))}}function le(e,t){if(1&e&&(u.Rb(0),u.Fc(1,re,2,2,"div",11),u.Fc(2,oe,2,2,"div",11),u.Qb()),2&e){const e=u.dc(2);u.zb(1),u.kc("ngForOf",e.basicProfileFields),u.zb(1),u.kc("ngForOf",e.customProfileFields)}}function ce(e,t){if(1&e&&(u.Tb(0,"label-value",25),u.Hc(1),u.Sb()),2&e){const e=u.dc().$implicit,t=u.dc(2);u.kc("label",t.i18n.general.user),u.zb(1),u.Jc(" ",t.recordOwner(e)," ")}}function de(e,t){if(1&e&&(u.Tb(0,"label-value",25),u.Ob(1,"format-field-value",31),u.Sb()),2&e){const e=t.$implicit,i=u.dc().$implicit,n=u.dc(2);u.kc("label",e.name),u.zb(1),u.kc("fields",n.data.customFields)("plainText",!0)("fieldName",e.internalName)("object",i)("customValues",i.customValues)}}function ue(e,t){if(1&e){const e=u.Ub();u.Tb(0,"button",32),u.bc("click",(function(t){u.wc(e);const i=u.dc().$implicit,n=u.dc(2);return n.router.navigate(n.editPath(i)),t.stopPropagation(),t.preventDefault()})),u.Ob(1,"icon",33),u.Sb()}if(2&e){const e=u.dc(3);u.kc("tooltip",e.i18n.general.edit)}}const be=function(e){return{"mt-2":e}};function fe(e,t){if(1&e){const e=u.Ub();u.Tb(0,"button",34),u.bc("click",(function(t){u.wc(e);const i=u.dc().$implicit;return u.dc(2).remove(i),t.stopPropagation(),t.preventDefault()})),u.Ob(1,"icon",35),u.Sb()}if(2&e){const e=u.dc(3);u.kc("tooltip",e.i18n.general.remove)("ngClass",u.nc(2,be,e.data.edit))}}function he(e,t){if(1&e&&(u.Tb(0,"mobile-result"),u.Tb(1,"div",24),u.Tb(2,"div"),u.Tb(3,"label-value",25),u.Hc(4),u.ec(5,"dateTime"),u.Sb(),u.Fc(6,ce,2,2,"label-value",26),u.Fc(7,de,2,6,"label-value",27),u.Sb(),u.Tb(8,"div",28),u.Fc(9,ue,2,1,"button",29),u.Fc(10,fe,2,4,"button",30),u.Sb(),u.Sb(),u.Sb()),2&e){const e=t.$implicit,i=u.dc(2);u.zb(3),u.kc("label",i.i18n.general.creationDate),u.zb(1),u.Jc(" ",u.fc(5,6,e.creationDate)," "),u.zb(2),u.kc("ngIf",i.generalSearch),u.zb(1),u.kc("ngForOf",i.fieldsInList),u.zb(2),u.kc("ngIf",i.data.edit),u.zb(1),u.kc("ngIf",i.data.remove)}}function pe(e,t){if(1&e&&(u.Tb(0,"th"),u.Hc(1),u.Sb()),2&e){const e=u.dc(3);u.zb(1),u.Ic(e.i18n.general.user)}}function me(e,t){if(1&e&&(u.Tb(0,"th"),u.Hc(1),u.Sb()),2&e){const e=t.$implicit,i=u.dc(3);u.zb(1),u.Jc(" ",i.fieldName(e.internalName)," ")}}function ge(e,t){if(1&e&&(u.Tb(0,"td"),u.Hc(1),u.Sb()),2&e){const e=u.dc().$implicit,t=u.dc(3);u.zb(1),u.Ic(t.recordOwner(e))}}function ve(e,t){if(1&e&&(u.Tb(0,"td"),u.Ob(1,"format-field-value",31),u.Sb()),2&e){const e=t.$implicit,i=u.dc().$implicit,n=u.dc(3);u.zb(1),u.kc("fields",n.data.customFields)("plainText",!0)("fieldName",e.internalName)("object",i)("customValues",i.customValues)}}function ye(e,t){if(1&e){const e=u.Ub();u.Tb(0,"button",32),u.bc("click",(function(t){u.wc(e);const i=u.dc().$implicit,n=u.dc(3);return n.router.navigate(n.editPath(i)),t.stopPropagation()})),u.Ob(1,"icon",33),u.Sb()}if(2&e){const e=u.dc(4);u.kc("tooltip",e.i18n.general.edit)}}function Fe(e,t){if(1&e){const e=u.Ub();u.Tb(0,"button",34),u.bc("click",(function(t){u.wc(e);const i=u.dc().$implicit;return u.dc(3).remove(i),t.stopPropagation()})),u.Ob(1,"icon",35),u.Sb()}if(2&e){const e=u.dc(4);u.kc("tooltip",e.i18n.general.remove)("ngClass",e.data.edit?"ml-3":"")}}function Se(e,t){if(1&e){const e=u.Ub();u.Tb(0,"tr",40),u.bc("click",(function(){u.wc(e);const i=t.$implicit,n=u.dc(3);return n.router.navigate(n.viewPath(i))})),u.Tb(1,"td"),u.Hc(2),u.ec(3,"dateTime"),u.Sb(),u.Fc(4,ge,2,1,"td",1),u.Fc(5,ve,2,5,"td",37),u.Tb(6,"td",41),u.Fc(7,ye,2,1,"button",29),u.Fc(8,Fe,2,2,"button",30),u.Sb(),u.Sb()}if(2&e){const e=t.$implicit,i=u.dc(3);u.zb(2),u.Ic(u.fc(3,5,e.creationDate)),u.zb(2),u.kc("ngIf",i.generalSearch),u.zb(1),u.kc("ngForOf",i.fieldsInList),u.zb(2),u.kc("ngIf",i.data.edit),u.zb(1),u.kc("ngIf",i.data.remove)}}function ke(e,t){if(1&e&&(u.Tb(0,"table",36),u.Tb(1,"thead"),u.Tb(2,"th"),u.Hc(3),u.Sb(),u.Fc(4,pe,2,1,"th",1),u.Fc(5,me,2,1,"th",37),u.Ob(6,"th",38),u.Sb(),u.Tb(7,"tbody"),u.Fc(8,Se,9,7,"tr",39),u.ec(9,"async"),u.Sb(),u.Sb()),2&e){const e=u.dc(2);var i;const t=null==(i=u.fc(9,4,e.results$))?null:i.results;u.zb(3),u.Ic(e.i18n.general.creationDate),u.zb(1),u.kc("ngIf",e.generalSearch),u.zb(1),u.kc("ngForOf",e.fieldsInList),u.zb(3),u.kc("ngForOf",t)}}function Te(e,t){if(1&e){const e=u.Ub();u.Rb(0),u.Tb(1,"page-content",2),u.ec(2,"async"),u.Tb(3,"form",3),u.Tb(4,"div",4),u.Fc(5,Z,5,3,"ng-container",1),u.Tb(6,"div",5),u.Ob(7,"input-field",6),u.Sb(),u.Fc(8,se,6,7,"ng-container",1),u.Tb(9,"div",5),u.Ob(10,"user-field",7),u.Sb(),u.Ob(11,"div",8),u.Tb(12,"div",5),u.Ob(13,"date-field",9),u.Sb(),u.Tb(14,"div",5),u.Ob(15,"date-field",10),u.Sb(),u.Fc(16,ae,2,2,"div",11),u.Fc(17,le,3,2,"ng-container",1),u.Sb(),u.Sb(),u.Sb(),u.Tb(18,"results-layout",12),u.bc("update",(function(t){return u.wc(e),u.dc().update(t)})),u.ec(19,"async"),u.Fc(20,he,11,8,"mobile-result",13),u.Fc(21,ke,10,6,"table",14),u.Sb(),u.Qb()}if(2&e){const e=u.dc();u.zb(1),u.kc("heading",e.data.type.pluralName)("mobileHeading",e.data.type.pluralName)("headingActions",u.fc(2,15,e.headingActions$)),u.zb(2),u.kc("formGroup",e.form),u.zb(2),u.kc("ngIf",e.user&&!e.authHelper.isSelf(e.user)),u.zb(2),u.kc("label",e.i18n.general.keywords),u.zb(1),u.kc("ngIf",e.generalSearch),u.zb(2),u.kc("label",e.i18n.record.createdBy),u.zb(3),u.kc("label",e.i18n.general.beginDate),u.zb(2),u.kc("label",e.i18n.general.endDate),u.zb(1),u.kc("ngForOf",e.fieldsInSearch),u.zb(1),u.kc("ngIf",e.generalSearch),u.zb(1),u.kc("results",u.fc(19,17,e.results$))("rendering$",e.rendering$)("toLink",e.toLink)}}let Ie=(()=>{class e extends V.a{constructor(e,t,i){super(e),this.recordsService=t,this.recordsHelper=i}ngOnInit(){super.ngOnInit(),this.param=this.route.snapshot.params.owner,this.type=this.route.snapshot.params.type,this.addSub(this.generalSearch?this.recordsService.getRecordDataForGeneralSearch({type:this.type}).subscribe(e=>this.data=e):this.recordsService.getRecordDataForOwnerSearch({owner:this.param,type:this.type}).subscribe(e=>this.data=e))}onDataInitialized(e){if(!this.generalSearch&&e.type.layout!==a.ab.LIST)throw new Error(`Invalid record layout: ${e.type.layout}`);if(this.fieldsInSearch=e.customFields.filter(t=>e.fieldsInSearch.includes(t.internalName)),this.fieldsInList=e.customFields.filter(t=>e.fieldsInList.includes(t.internalName)),this.form.setControl("customValues",this.fieldHelper.customFieldsForSearchFormGroup(this.fieldsInSearch)),this.generalSearch){const t=e;this.basicProfileFields=t.basicProfileFields,this.customProfileFields=t.customProfileFields,this.groups=t.groups||[],this.form.setControl("profileFields",this.fieldHelper.profileFieldsForSearchFormGroup(this.basicProfileFields,this.customProfileFields))}this.form.patchValue(e.query);const t=[];!this.generalSearch&&e.create&&t.push(new H.c("add",this.i18n.general.addNew,()=>this.router.navigate(["/records",this.param,this.type,"new"]),!0)),this.exportHelper.headingActions(e.exportFormats,e=>{const t=Object.assign({format:e.internalName},this.toSearchParams(this.form.value));return this.generalSearch?this.recordsService.exportGeneralRecords$Response(t):this.recordsService.exportOwnerRecords$Response(t)}),this.headingActions=t,super.onDataInitialized(e)}doSearch(e){return this.generalSearch?this.recordsService.searchGeneralRecords$Response(e):this.recordsService.searchOwnerRecords$Response(e)}remove(e){this.notification.confirm({message:this.i18n.general.removeItemConfirm,callback:()=>this.doRemove(e)})}doRemove(e){this.addSub(this.recordsService.deleteRecord({id:e.id}).subscribe(()=>{this.notification.snackBar(this.i18n.general.removeItemDone),this.update()}))}recordOwner(e){return this.generalSearch?e.user.display:""}fieldName(e){return this.fieldHelper.fieldDisplay(e,this.data.customFields)}viewPath(e){return["/records","view",e.id]}editPath(e){return["/records","edit",e.id]}get toLink(){return e=>this.viewPath(e)}get user(){return this.data?this.data.user:null}toSearchParams(e){const t=Object.assign({},e);if(t.customFields=this.fieldHelper.toCustomValuesFilter(e.customValues),t.profileFields=this.fieldHelper.toProfileFieldsFilter(e.profileFields),t.creationPeriod=N.a.dateRangeFilter(e.beginDate,e.endDate),this.generalSearch){const i=t;i.brokers=e.broker?[e.broker]:[],delete i.broker}else t.owner=this.param;return t.type=this.type,t}getFormControlNames(){return["keywords","customValues","createdBy","beginDate","endDate","broker","groups","user","profileFields"]}resolveMenu(e){return this.recordsHelper.menuForRecordType(this.generalSearch?null:e.user,e.type)}get generalSearch(){return this.param===o.a.GENERAL_SEARCH}}return e.\u0275fac=function(t){return new(t||e)(u.Nb(u.r),u.Nb(r.C),u.Nb(o.a))},e.\u0275cmp=u.Hb({type:e,selectors:[["search-records"]],features:[u.wb],decls:3,vars:4,consts:[[3,"ready"],[4,"ngIf"],["mode","filters",3,"heading","mobileHeading","headingActions"],[1,"filters-form","filters-form-separator","border-0",3,"formGroup"],[1,"row"],[1,"col-12","col-md-6"],["labelPosition","side","formControlName","keywords","fieldSize","full",3,"label"],["labelPosition","side","formControlName","createdBy",3,"label"],[1,"w-100"],["labelPosition","side","formControlName","beginDate","minDate","past100","maxDate","todayEnd","fieldSize","full",3,"label"],["labelPosition","side","formControlName","endDate","minDate","past100","maxDate","todayEnd","fieldSize","full",3,"label"],["class","col-12 col-md-6",4,"ngFor","ngForOf"],["resultType","list",3,"results","rendering$","toLink","update"],[4,"mobileResult"],["class","table table-hover cursor-pointer",4,"resultTable"],["labelPosition","side","kind","fieldView",3,"label"],[3,"user"],["class","col-12 col-md-6",4,"ngIf"],["labelPosition","side","formControlName","broker",3,"label","filters"],["labelPosition","side","formControlName","user",3,"label"],["labelPosition","side","hierarchyProperty","groupSet","formControlName","groups",3,"label"],[3,"value","internalName","id","text","parent",4,"ngFor","ngForOf"],[3,"value","internalName","id","text","parent"],["labelPosition","side",3,"field","formControl"],[1,"d-flex"],["labelPosition","above",3,"label"],["labelPosition","above",3,"label",4,"ngIf"],["labelPosition","above",3,"label",4,"ngFor","ngForOf"],[1,"ml-auto","text-right","d-flex","flex-column"],["class","btn btn-icon",3,"tooltip","click",4,"ngIf"],["class","btn btn-icon",3,"tooltip","ngClass","click",4,"ngIf"],[3,"fields","plainText","fieldName","object","customValues"],[1,"btn","btn-icon",3,"tooltip","click"],["icon","edit"],[1,"btn","btn-icon",3,"tooltip","ngClass","click"],["icon","clear"],[1,"table","table-hover","cursor-pointer"],[4,"ngFor","ngForOf"],[1,"actions"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"actions","actions-multiple"]],template:function(e,t){1&e&&(u.Tb(0,"page-layout",0),u.ec(1,"async"),u.Fc(2,Te,22,19,"ng-container",1),u.Sb()),2&e&&(u.kc("ready",u.fc(1,2,t.data$)),u.zb(2),u.kc("ngIf",t.data))},directives:[b.a,f.t,h.a,p.I,p.w,p.n,x.a,p.v,p.l,D.a,L.a,f.s,A.a,M.a,B.a,E.a,J.a,U.a,W.a,j.a,p.k,G.a,q.a,Q.a,_.b,K.a,f.q],pipes:[f.b,Y.a],encapsulation:2,changeDetection:0}),e})();var ze=i("2Vo4");function we(e,t){if(1&e&&(u.Rb(0),u.Ob(1,"user-info",4),u.Ob(2,"hr"),u.Qb()),2&e){const e=u.dc(2);u.zb(1),u.kc("user",e.data.user)}}function Oe(e,t){1&e&&u.Ob(0,"hr")}function Ce(e,t){if(1&e&&(u.Tb(0,"label-value",5),u.Hc(1),u.ec(2,"dateTime"),u.Sb()),2&e){const e=u.dc().$implicit,t=u.dc(2);u.kc("label",t.i18n.record.lastModificationDate),u.zb(1),u.Jc(" ",u.fc(2,2,e.lastModificationDate)," ")}}function Pe(e,t){if(1&e&&(u.Tb(0,"label-value",5),u.Hc(1),u.Sb()),2&e){const e=u.dc().$implicit,t=u.dc(2);u.kc("label",t.i18n.record.lastModifiedBy),u.zb(1),u.Jc(" ",e.lastModifiedBy.display," ")}}function Re(e,t){if(1&e&&(u.Tb(0,"label-value",5),u.Ob(1,"format-field-value",12),u.Sb()),2&e){const e=t.$implicit,i=u.dc().$implicit,n=u.dc(2);u.kc("label",e.name),u.zb(1),u.kc("fields",n.data.customFields)("plainText",!0)("fieldName",e.internalName)("object",i)("customValues",i.customValues)}}function $e(e,t){if(1&e){const e=u.Ub();u.Tb(0,"button",10),u.bc("click",(function(){u.wc(e);const t=u.dc().$implicit,i=u.dc(2);return i.router.navigate(i.editPath(t))})),u.ec(1,"async"),u.Hc(2),u.Sb()}if(2&e){const e=u.dc(3);u.kc("disabled",u.fc(1,2,e.requesting$)),u.zb(2),u.Ic(e.i18n.general.edit)}}function He(e,t){if(1&e){const e=u.Ub();u.Tb(0,"button",13),u.bc("click",(function(){u.wc(e);const t=u.dc().$implicit;return u.dc(2).remove(t)})),u.ec(1,"async"),u.Hc(2),u.Sb()}if(2&e){const e=u.dc(3);u.kc("disabled",u.fc(1,2,e.requesting$)),u.zb(2),u.Ic(e.i18n.general.remove)}}function Ne(e,t){if(1&e){const e=u.Ub();u.Rb(0),u.Fc(1,Oe,1,0,"hr",1),u.Tb(2,"label-value",5),u.Hc(3),u.ec(4,"dateTime"),u.Sb(),u.Tb(5,"label-value",5),u.Hc(6),u.Sb(),u.Fc(7,Ce,3,4,"label-value",6),u.Fc(8,Pe,2,2,"label-value",6),u.Fc(9,Re,2,6,"label-value",7),u.Tb(10,"actions",8),u.Fc(11,$e,3,4,"button",9),u.Tb(12,"button",10),u.bc("click",(function(){u.wc(e);const i=t.$implicit,n=u.dc(2);return n.router.navigate(n.viewPath(i))})),u.ec(13,"async"),u.Hc(14),u.Sb(),u.Fc(15,He,3,4,"button",11),u.Sb(),u.Qb()}if(2&e){const e=t.$implicit,i=t.first,n=u.dc(2);u.zb(1),u.kc("ngIf",!i),u.zb(1),u.kc("label",n.i18n.general.creationDate),u.zb(1),u.Jc(" ",u.fc(4,12,e.creationDate)," "),u.zb(2),u.kc("label",n.i18n.record.createdBy),u.zb(1),u.Jc(" ",e.createdBy.display," "),u.zb(1),u.kc("ngIf",e.lastModifiedBy),u.zb(1),u.kc("ngIf",e.lastModifiedBy),u.zb(1),u.kc("ngForOf",n.fieldsInList),u.zb(2),u.kc("ngIf",n.data.edit),u.zb(1),u.kc("disabled",u.fc(13,14,n.requesting$)),u.zb(2),u.Ic(n.i18n.general.view),u.zb(1),u.kc("ngIf",n.data.remove)}}function Ve(e,t){if(1&e&&(u.Rb(0),u.Tb(1,"page-content",2),u.ec(2,"async"),u.Fc(3,we,3,1,"ng-container",1),u.Fc(4,Ne,16,16,"ng-container",3),u.ec(5,"async"),u.Sb(),u.Qb()),2&e){const e=u.dc();u.zb(1),u.kc("heading",e.data.type.pluralName)("mobileHeading",e.data.type.pluralName)("headingActions",u.fc(2,5,e.headingActions$)),u.zb(2),u.kc("ngIf",e.data.user&&!e.authHelper.isSelf(e.data.user)),u.zb(1),u.kc("ngForOf",u.fc(5,7,e.results$))}}let xe=(()=>{class e extends l.a{constructor(e,t,i){super(e),this.recordsService=t,this.recordsHelper=i,this.results$=new ze.a(null)}ngOnInit(){super.ngOnInit(),this.param=this.route.snapshot.params.owner,this.type=this.route.snapshot.params.type,this.addSub(this.recordsService.getRecordDataForOwnerSearch({owner:this.param,type:this.type}).subscribe(e=>{if(e.type.layout!==a.ab.TILED)throw new Error(`Invalid record layout: ${e.type.layout}`);this.fieldsInList=e.customFields.filter(t=>e.fieldsInList.includes(t.internalName)),this.data=e}))}onDataInitialized(e){const t=[];e.create&&t.push(new H.c("add",this.i18n.general.addNew,()=>this.router.navigate(["/records",this.param,this.type,"new"]),!0)),this.headingActions=t,this.addSub(this.doSearch(this.toSearchParams()).subscribe(e=>{this.results$.next(e.body)}))}editPath(e){return["/records","edit",e.id]}viewPath(e){return["/records","view",e.id]}remove(e){this.notification.confirm({message:this.i18n.general.removeItemConfirm,callback:()=>this.doRemove(e)})}doRemove(e){this.addSub(this.recordsService.deleteRecord({id:e.id}).subscribe(()=>{this.notification.snackBar(this.i18n.general.removeItemDone),this.reload()}))}toSearchParams(){return{pageSize:2147483647,owner:this.param,type:this.type}}doSearch(e){return this.recordsService.searchOwnerRecords$Response(e)}getFormControlNames(){return[]}resolveMenu(e){return this.recordsHelper.menuForRecordType(e.user,e.type)}}return e.\u0275fac=function(t){return new(t||e)(u.Nb(u.r),u.Nb(r.C),u.Nb(o.a))},e.\u0275cmp=u.Hb({type:e,selectors:[["tiled-records"]],features:[u.wb],decls:3,vars:4,consts:[[3,"ready"],[4,"ngIf"],[3,"heading","mobileHeading","headingActions"],[4,"ngFor","ngForOf"],[3,"user"],[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[1,"mb-3"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-outline-primary",3,"disabled","click",4,"ngIf"],[3,"fields","plainText","fieldName","object","customValues"],[1,"btn","btn-outline-primary",3,"disabled","click"]],template:function(e,t){1&e&&(u.Tb(0,"page-layout",0),u.ec(1,"async"),u.Fc(2,Ve,6,9,"ng-container",1),u.Sb()),2&e&&(u.kc("ready",u.fc(1,2,t.data$)),u.zb(2),u.kc("ngIf",t.data))},directives:[b.a,f.t,h.a,f.s,g.a,E.a,m.a,Q.a],pipes:[f.b,Y.a],encapsulation:2,changeDetection:0}),e})();var De=i("aLb1"),Le=i("MhyI"),Ae=i("nznZ");function Me(e,t){if(1&e&&(u.Tb(0,"label-value",9),u.Ob(1,"user-link",10),u.Sb()),2&e){const e=u.dc(2);u.Bb(e.resolveColumnClass()),u.kc("labelPosition",e.labelPosition)("label",e.i18n.general.user),u.zb(1),u.kc("user",e.data.user)}}function Be(e,t){if(1&e&&(u.Tb(0,"label-value",9),u.Hc(1),u.ec(2,"dateTime"),u.Sb()),2&e){const e=u.dc(2);u.Bb(e.resolveColumnClass()),u.kc("labelPosition",e.labelPosition)("label",e.i18n.general.creationDate),u.zb(1),u.Jc(" ",u.fc(2,5,e.data.creationDate)," ")}}function Ee(e,t){if(1&e&&(u.Tb(0,"label-value",9),u.Hc(1),u.Sb()),2&e){const e=u.dc(2);u.Bb(e.resolveColumnClass()),u.kc("labelPosition",e.labelPosition)("label",e.i18n.record.createdBy),u.zb(1),u.Jc(" ",e.data.createdBy.display," ")}}function Je(e,t){if(1&e&&(u.Tb(0,"label-value",9),u.Hc(1),u.ec(2,"dateTime"),u.Sb()),2&e){const e=u.dc(2);u.Bb(e.resolveColumnClass()),u.kc("labelPosition",e.labelPosition)("label",e.i18n.record.lastModificationDate),u.zb(1),u.Jc(" ",u.fc(2,5,e.data.lastModificationDate)," ")}}function Ue(e,t){if(1&e&&(u.Tb(0,"label-value",9),u.Hc(1),u.Sb()),2&e){const e=u.dc(2);u.Bb(e.resolveColumnClass()),u.kc("labelPosition",e.labelPosition)("label",e.i18n.record.lastModifiedBy),u.zb(1),u.Jc(" ",e.data.lastModifiedBy.display," ")}}function We(e,t){1&e&&u.Ob(0,"hr")}function je(e,t){1&e&&u.Ob(0,"hr")}function Ge(e,t){if(1&e&&(u.Rb(0),u.Fc(1,We,1,0,"hr",5),u.Ob(2,"rich-text-container",11),u.Fc(3,je,1,0,"hr",5),u.Qb()),2&e){const e=u.dc(2);u.zb(1),u.kc("ngIf",e.hasPreviousFields),u.zb(1),u.kc("value",e.data.type.informationText),u.zb(1),u.kc("ngIf",e.data.customValues)}}const qe=function(e,t,i){return{"mt-2 pt-0 border-0":e,"mb-0":t,"mb-2":i}};function Qe(e,t){if(1&e&&(u.Tb(0,"h2",3),u.Hc(1),u.Sb()),2&e){const e=u.dc(2);u.kc("ngClass",u.pc(2,qe,e.data.type.informationText,"above"===e.labelPosition,"above"!==e.labelPosition)),u.zb(1),u.Jc(" ",e.i18n.record.fields," ")}}const _e=function(e){return{"mt-0":e}};function Ke(e,t){if(1&e&&u.Ob(0,"custom-field-value",12),2&e){const e=t.$implicit,i=u.dc(2);u.Bb(i.resolveColumnClass(e)),u.kc("labelPosition",i.labelPosition)("fieldValue",e)("ngClass",u.nc(5,_e,!(i.hasPreviousFields&&i.valuesWithoutSection.length>0)))}}function Ye(e,t){if(1&e&&u.Ob(0,"custom-field-value",14),2&e){const e=t.$implicit,i=u.dc(3);u.Bb(i.resolveColumnClass(e)),u.kc("labelPosition",i.labelPosition)("fieldValue",e)}}const Xe=function(e,t,i,n){return{"mt-4":e,"mb-0":t,"mb-2":i,"border-top-0":n}};function Ze(e,t){if(1&e&&(u.Rb(0),u.Tb(1,"h2",3),u.Hc(2),u.Sb(),u.Fc(3,Ye,1,4,"custom-field-value",13),u.Qb()),2&e){const e=t.$implicit,i=t.first,n=u.dc(2);u.zb(1),u.kc("ngClass",u.qc(3,Xe,n.valuesWithoutSection.length>0,"above"===n.labelPosition,"above"!==n.labelPosition,i&&0==n.valuesWithoutSection.length&&(!n.hasPreviousFields||n.data.type.informationText))),u.zb(1),u.Jc(" ",e.name," "),u.zb(1),u.kc("ngForOf",n.valuesWithSection.get(e))}}const et=function(e,t){return{"d-flex flex-row-reverse":e,"mt-n3":t}},tt=function(e,t){return{"d-flex flex-grow-1 flex-column":e,"mr-n3":t}};function it(e,t){if(1&e&&(u.Tb(0,"page-content",2),u.ec(1,"async"),u.Tb(2,"div",3),u.Tb(3,"div",3),u.Fc(4,Me,2,5,"label-value",4),u.Fc(5,Be,3,7,"label-value",4),u.Fc(6,Ee,2,5,"label-value",4),u.Fc(7,Je,3,7,"label-value",4),u.Fc(8,Ue,2,5,"label-value",4),u.Fc(9,Ge,4,3,"ng-container",5),u.Fc(10,Qe,2,6,"h2",6),u.Fc(11,Ke,1,7,"custom-field-value",7),u.Fc(12,Ze,4,8,"ng-container",8),u.Sb(),u.Sb(),u.Sb()),2&e){const e=u.dc();u.kc("heading",e.i18n.record.title.details(e.title))("mobileHeading",e.i18n.record.mobileTitle.details(e.title))("headingActions",u.fc(1,14,e.headingActions$)),u.zb(2),u.kc("ngClass",u.oc(16,et,!e.columnLayout,e.hasPreviousFields&&e.columnLayout)),u.zb(1),u.kc("ngClass",u.oc(19,tt,!e.columnLayout,e.columnLayout)),u.zb(1),u.kc("ngIf",!e.isOwner()),u.zb(1),u.kc("ngIf",e.data.creationDate),u.zb(1),u.kc("ngIf",e.data.createdBy),u.zb(1),u.kc("ngIf",e.data.lastModificationDate),u.zb(1),u.kc("ngIf",e.data.lastModifiedBy),u.zb(1),u.kc("ngIf",e.data.type.informationText),u.zb(1),u.kc("ngIf",e.hasPreviousFields&&e.valuesWithoutSection.length>0),u.zb(1),u.kc("ngForOf",e.valuesWithoutSection),u.zb(1),u.kc("ngForOf",e.valuesWithSection.keys())}}const nt=[{path:":owner/:type/list",component:Ie,canActivate:[s.a]},{path:":owner/:type/tiled",component:xe,canActivate:[s.a]},{path:"view/:id",component:(()=>{class e extends Le.a{constructor(e,t,i,n){super(e),this.recordsService=t,this.recordsHelper=i,this.operationHelper=n,this.valuesWithSection=new Map}ngOnInit(){super.ngOnInit();const e=this.route.snapshot.paramMap.get("id");this.addSub(this.recordsService.viewRecord({id:e}).subscribe(e=>{this.data=e}))}onDataInitialized(e){this.headingActions=[],this.title=Object(c.h)(e.display)?e.type.name:e.display,this.columnLayout=this.recordsHelper.isColumnLayout(e.type);const t=e.customValues||[];this.valuesWithoutSection=t.filter(e=>null==e.field.section)||[],(e.type.sections||[]).forEach(e=>{const i=t.filter(t=>null!=t.field.section&&t.field.section.id===e.id);i&&this.valuesWithSection.set(e,i)}),e.canEdit&&this.headingActions.push(new H.c("edit",this.i18n.general.edit,()=>{this.router.navigate(["/records","edit",e.id])},!0));for(const i of e.operations||[])this.headingActions.push(this.operationHelper.headingAction(i,e.id))}resolveColumnClass(e=null){return this.recordsHelper.resolveColumnClass(null==e?null:e.field,this.data.type)}get labelPosition(){return this.columnLayout?"above":"auto"}get hasPreviousFields(){return this.data.createdBy||this.data.lastModifiedBy}isOwner(){return this.authHelper.isSelf(this.data.user)}resolveMenu(e){return this.recordsHelper.menuForRecordType(e.user,e.type)}}return e.\u0275fac=function(t){return new(t||e)(u.Nb(u.r),u.Nb(r.C),u.Nb(o.a),u.Nb(De.a))},e.\u0275cmp=u.Hb({type:e,selectors:[["view-record"]],features:[u.wb],decls:3,vars:4,consts:[[3,"ready"],["last","","mode","viewForm",3,"heading","mobileHeading","headingActions",4,"ngIf"],["last","","mode","viewForm",3,"heading","mobileHeading","headingActions"],[3,"ngClass"],[3,"labelPosition","class","label",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],[3,"labelPosition","fieldValue","class","ngClass",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"labelPosition","label"],[3,"user"],[3,"value"],[3,"labelPosition","fieldValue","ngClass"],[3,"labelPosition","fieldValue","class",4,"ngFor","ngForOf"],[3,"labelPosition","fieldValue"]],template:function(e,t){1&e&&(u.Tb(0,"page-layout",0),u.ec(1,"async"),u.Fc(2,it,13,22,"page-content",1),u.Sb()),2&e&&(u.kc("ready",u.fc(1,2,t.data$)),u.zb(2),u.kc("ngIf",t.data))},directives:[b.a,f.t,h.a,f.q,f.s,E.a,J.a,v.a,Ae.a],pipes:[f.b,Y.a],encapsulation:2,changeDetection:0}),e})(),canActivate:[s.a]},{path:":owner/:type/new",component:$,canActivate:[s.a]},{path:"edit/:id",component:$,canActivate:[s.a]}];let st=(()=>{class e{}return e.\u0275mod=u.Lb({type:e}),e.\u0275inj=u.Kb({factory:function(t){return new(t||e)},imports:[[n.i.forChild(nt)],n.i]}),e})();var at=i("PCNd");let rt=(()=>{class e{}return e.\u0275mod=u.Lb({type:e}),e.\u0275inj=u.Kb({factory:function(t){return new(t||e)},imports:[[st,at.a]]}),e})()},tVPo:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i("s7LF"),s=i("mwYl"),a=i("tAww"),r=i("rCAV"),o=i("x6mR"),l=i("Ky6R"),c=i("75v4"),d=i("LvDl"),u=i("2Vo4"),b=i("Kj3r"),f=i("8Y7J");let h=(()=>{class e extends o.a{constructor(e){super(e),this.ResultType=c.a,this.resultType$=new u.a(null),this.resultTypeControl=new n.j(null),this.results$=new u.a(null),this.allowedResultTypes$=new u.a([c.a.LIST]),this.rendering$=new u.a(!1),this.moreFilters$=new u.a(!1),this.ignoreNextUpdate=!1,this.nextRequestState=e.get(s.a);const t={page:0};t.resultType=this.getInitialResultType();for(const i of this.getFormControlNames()||[])t[i]=null;this.form=this.formBuilder.group(t)}getInitialFormValue(e){return e.query||{}}onDataInitialized(e){this.form.patchValue(this.getInitialFormValue(e)),this.stateManager.manage(this.form),this.stateManager.manage(this.resultTypeControl,"resultType"),this.stateManager.manageValue(this.moreFilters$,"moreFilters"),this.previousValue=this.form.value,this.previousResultType=this.resultType,this.resultType$.next(this.previousResultType),this.addSub(this.resultTypeControl.valueChanges.subscribe(e=>{const t=this.previousResultType;this.previousResultType=e,this.resultType$.next(e),this.shouldUpdateOnResultTypeChange(e,t)&&this.update(),null!=t&&t===e||(this.rendering=!0,this.stateManager.set("resultType",e),this.onResultTypeChanged(e,t))})),setTimeout(()=>{this.addSub(this.form.valueChanges.pipe(Object(b.a)(r.a.DEBOUNCE_TIME)).subscribe(e=>{this.shouldUpdateOnChange(e)&&this.update(),this.previousValue=e}),!0),this.previousResultType!==c.a.CATEGORIES&&this.update()},1)}shouldUpdateOnResultTypeChange(e,t){return e!==c.a.CATEGORIES&&([c.a.LIST,c.a.TILES].includes(t)!==[c.a.LIST,c.a.TILES].includes(e)||t===c.a.MAP!=(e===c.a.MAP))}shouldUpdateOnChange(e){return!Object(d.isEqual)(this.previousValue,e)}get results(){return this.results$.value}set results(e){this.results$.next(e)}get rendering(){return this.rendering$.value}set rendering(e){this.rendering$.next(e)}get allowedResultTypes(){return this.allowedResultTypes$.value}set allowedResultTypes(e){this.allowedResultTypes$.next(e)}get moreFilters(){return this.moreFilters$.value}set moreFilters(e){this.moreFilters$.next(e)}get pageData(){const e=this.form.value;return{page:e.page,pageSize:e.pageSize}}set pageData(e){this.form.patchValue(e)}get resultType(){return this.resultTypeControl.value}set resultType(e){null==e&&(e=this.getInitialResultType()),this.resultTypeControl.setValue(e)}ngOnInit(){super.ngOnInit(),this.resultType=this.getInitialResultType()}get moreFiltersAction(){return this._moreFiltersAction||(this._moreFiltersAction=new a.c(this.showMoreFiltersIcon(),this.showMoreFiltersLabel(),()=>{this.moreFilters=!this.moreFilters,this._moreFiltersAction.icon=this.moreFilters?this.showLessFiltersIcon():this.showMoreFiltersIcon(),this._moreFiltersAction.label=this.moreFilters?this.showLessFiltersLabel():this.showMoreFiltersLabel()},!0),this._moreFiltersAction.breakpoint="gt-xxs",this._moreFiltersAction.maybeRoot=!0),this._moreFiltersAction}showMoreFiltersLabel(){return this.i18n.general.showMoreFilters}showLessFiltersLabel(){return this.i18n.general.showLessFilters}showMoreFiltersIcon(){return"filter_list"}showLessFiltersIcon(){return"filter_list"}onResultTypeChanged(e,t){}getInitialResultType(){return c.a.LIST}update(e){if(this.ignoreNextUpdate)return;e&&(this.form.patchValue(e,{emitEvent:!1}),this.stateManager.set("form",this.form.value)),this.rendering=!0,this.results=null,this.nextRequestState.leaveNotification=!0;const t=this.form.value;t.pageSize=this.layout.searchPageSize,this.addSub(this.doSearch(this.toSearchParams(t)).subscribe(e=>{this.resultType===c.a.CATEGORIES&&(this.resultType=this.allowedResultTypes.find(e=>e!==c.a.CATEGORIES)),this.results=l.a.from(e)}))}resetPage(e=!1){this.form.patchValue({page:0},{emitEvent:e})}doIgnoringUpdate(e){this.ignoreNextUpdate=!0;try{e()}finally{this.ignoreNextUpdate=!1}}}return e.\u0275fac=function(t){return new(t||e)(f.Nb(f.r))},e.\u0275dir=f.Ib({type:e,features:[f.wb]}),e})()}}]);